<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Minesweeper + Treasures</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --cell-size: 32px;
  --bg:#020617;
  --panel:#0f172a;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --gold:#facc15;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  min-height:100vh;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:var(--text);
  font-family:system-ui, sans-serif;
  display:flex;
  justify-content:center;
  padding:12px;
}

.game{
  max-width:1100px;
  width:100%;
  display:grid;
  grid-template-columns:1fr 260px;
  gap:12px;
}

@media(max-width:900px){
  .game{grid-template-columns:1fr}
}

.panel{
  background:var(--panel);
  border-radius:16px;
  padding:12px;
}

.hud{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:10px;
}

.pill{
  background:#020617;
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  border:1px solid #334155;
}

.board-wrap{
  background:#020617;
  padding:12px;
  border-radius:14px;
}

.board{
  display:grid;
  grid-template-columns:repeat(15,var(--cell-size));
  gap:2px;
  justify-content:center;
}

.cell{
  width:var(--cell-size);
  height:var(--cell-size);
  border-radius:6px;
  border:0;
  cursor:pointer;
  background:#020617;
  color:var(--text);
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:inset 0 0 0 1px #334155;
}

.cell.revealed{
  background:#1e293b;
  cursor:default;
}

.cell.mine{
  background:#b91c1c;
  color:#020617;
}

.cell.flagged{
  box-shadow:inset 0 0 0 2px var(--gold);
}

.cell.treasure{
  background:radial-gradient(circle,#facc15,#1e293b);
  color:#020617;
}

.message{
  margin-top:8px;
  font-size:13px;
  color:var(--muted);
}

.sidebar h3{
  margin-bottom:6px;
}

.sidebar p{
  font-size:12px;
  color:var(--muted);
  line-height:1.4;
}
</style>
</head>

<body>
<div class="game">
  <div class="panel">
    <div class="hud">
      <div class="pill">â± <span id="time">0s</span></div>
      <div class="pill">ğŸš© <span id="flags">0</span></div>
      <div class="pill">ğŸ <span id="treasures">0</span></div>
      <div class="pill">ğŸ›¡ <span id="shield">OFF</span></div>
    </div>

    <div class="board-wrap">
      <div id="board" class="board"></div>
    </div>

    <div class="message" id="msg">
      Click to reveal â€¢ Right-click / long-press to flag
    </div>
  </div>

  <aside class="panel sidebar">
    <h3>Legend</h3>
    <p>ğŸ’£ Mine â€” game over</p>
    <p>ğŸ Treasure â€” 20% chance on numbers</p>
    <p>ğŸ§¯ Defuse â€” auto-flags a mine</p>
    <p>ğŸ” Scan â€” reveals nearby safe tiles</p>
    <p>ğŸ›¡ Shield â€” blocks one mine</p>
  </aside>
</div>

<script>
const SIZE = 15;
const MINES = 40;
const TREASURE_CHANCE = 0.20;

const boardEl = document.getElementById("board");
const timeEl = document.getElementById("time");
const flagsEl = document.getElementById("flags");
const treasureEl = document.getElementById("treasures");
const shieldEl = document.getElementById("shield");
const msgEl = document.getElementById("msg");

let board=[];
let flags=0;
let treasures=0;
let shield=false;
let startTime=null;
let timer=null;

function updateCellSize(){
  const size=Math.floor(Math.min(window.innerWidth,700)/18);
  document.documentElement.style.setProperty(
    "--cell-size",
    Math.max(22,Math.min(size,40))+"px"
  );
}
window.addEventListener("resize",updateCellSize);
updateCellSize();

const idx=(r,c)=>r*SIZE+c;
const inB=(r,c)=>r>=0&&c>=0&&r<SIZE&&c<SIZE;
const neighbors=(r,c)=>{
  let a=[];
  for(let dr=-1;dr<=1;dr++)
    for(let dc=-1;dc<=1;dc++)
      if(dr||dc){
        let rr=r+dr,cc=c+dc;
        if(inB(rr,cc))a.push([rr,cc]);
      }
  return a;
};

function build(){
  board=[];
  boardEl.innerHTML="";
  flags=0; treasures=0; shield=false;
  flagsEl.textContent=0;
  treasureEl.textContent=0;
  shieldEl.textContent="OFF";
  msgEl.textContent="Click to reveal â€¢ Right-click to flag";

  for(let i=0;i<SIZE*SIZE;i++)
    board.push({mine:false,revealed:false,flag:false,num:0});

  let pos=[...Array(SIZE*SIZE).keys()].sort(()=>Math.random()-0.5);
  for(let i=0;i<MINES;i++) board[pos[i]].mine=true;

  for(let r=0;r<SIZE;r++)
    for(let c=0;c<SIZE;c++){
      let cell=board[idx(r,c)];
      if(cell.mine){cell.num=-1;continue;}
      cell.num=neighbors(r,c).filter(([rr,cc])=>board[idx(rr,cc)].mine).length;
    }

  for(let r=0;r<SIZE;r++)
    for(let c=0;c<SIZE;c++){
      let b=document.createElement("button");
      b.className="cell";
      b.oncontextmenu=e=>{e.preventDefault();flag(r,c);}
      b.onclick=()=>reveal(r,c);
      boardEl.appendChild(b);
    }
}

function reveal(r,c){
  let cell=board[idx(r,c)];
  let el=boardEl.children[idx(r,c)];
  if(cell.revealed||cell.flag)return;

  if(!startTime){
    startTime=Date.now();
    timer=setInterval(()=>timeEl.textContent=
      Math.floor((Date.now()-startTime)/1000)+"s",500);
  }

  if(cell.mine){
    if(shield){
      shield=false;
      shieldEl.textContent="OFF";
      flag(r,c);
      msgEl.textContent="ğŸ›¡ Shield saved you!";
      return;
    }
    el.textContent="ğŸ’£";
    el.classList.add("mine");
    msgEl.textContent="ğŸ’¥ Game Over";
    clearInterval(timer);
    return;
  }

  cell.revealed=true;
  el.classList.add("revealed");

  if(cell.num>0){
    el.textContent=cell.num;
    if(Math.random()<TREASURE_CHANCE) treasure(r,c);
  }else{
    neighbors(r,c).forEach(([rr,cc])=>reveal(rr,cc));
  }
}

function flag(r,c){
  let cell=board[idx(r,c)];
  let el=boardEl.children[idx(r,c)];
  if(cell.revealed)return;
  cell.flag=!cell.flag;
  el.textContent=cell.flag?"ğŸš©":"";
  flags+=cell.flag?1:-1;
  flagsEl.textContent=flags;
}

function treasure(r,c){
  treasures++;
  treasureEl.textContent=treasures;
  let el=boardEl.children[idx(r,c)];
  el.textContent="ğŸ";
  el.classList.add("treasure");

  let roll=Math.random();
  if(roll<0.33){
    let m=board.findIndex(x=>x.mine&&!x.flag);
    if(m>=0){board[m].flag=true;boardEl.children[m].textContent="ğŸš©";}
    msgEl.textContent="ğŸ Defuse!";
  }else if(roll<0.66){
    neighbors(r,c).forEach(([rr,cc])=>{
      let n=board[idx(rr,cc)];
      if(!n.mine) reveal(rr,cc);
    });
    msgEl.textContent="ğŸ Scan!";
  }else{
    shield=true;
    shieldEl.textContent="ON";
    msgEl.textContent="ğŸ Shield!";
  }
}

build();
</script>
</body>
</html>
